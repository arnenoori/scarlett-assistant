{"version":3,"file":"sort.js","sourceRoot":"","sources":["../../src/__builtins__/sort.tsx"],"names":[],"mappings":"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","sourcesContent":["import { DndContext, DragEndEvent, DragStartEvent } from '@dnd-kit/core'\nimport {\n  SortableContext,\n  useSortable,\n  verticalListSortingStrategy,\n} from '@dnd-kit/sortable'\nimport { ReactFC } from '@formily/reactive-react'\nimport React, { createContext, useContext, useMemo } from 'react'\n\nexport interface ISortableContainerProps {\n  list: any[]\n  start?: number\n  accessibility?: {\n    container?: Element\n  }\n  onSortStart?: (event: DragStartEvent) => void\n  onSortEnd?: (event: { oldIndex: number; newIndex: number }) => void\n}\n\nexport function SortableContainer<T extends React.HTMLAttributes<HTMLElement>>(\n  Component: ReactFC<T>\n): ReactFC<ISortableContainerProps & T> {\n  return ({\n    list,\n    start = 0,\n    accessibility,\n    onSortStart,\n    onSortEnd,\n    ...props\n  }) => {\n    const _onSortEnd = (event: DragEndEvent) => {\n      const { active, over } = event\n      const oldIndex = (active.id as number) - 1\n      const newIndex = (over?.id as number) - 1\n      onSortEnd?.({\n        oldIndex,\n        newIndex,\n      })\n    }\n\n    return (\n      <DndContext\n        accessibility={accessibility}\n        onDragStart={onSortStart}\n        onDragEnd={_onSortEnd}\n      >\n        <SortableContext\n          items={list.map((_, index) => index + start + 1)}\n          strategy={verticalListSortingStrategy}\n        >\n          <Component {...(props as unknown as T)}>{props.children}</Component>\n        </SortableContext>\n      </DndContext>\n    )\n  }\n}\n\nexport const useSortableItem = () => {\n  return useContext(SortableItemContext)\n}\n\nexport const SortableItemContext = createContext<\n  Partial<ReturnType<typeof useSortable>>\n>({})\n\nexport interface ISortableElementProps {\n  index?: number\n  lockAxis?: 'x' | 'y'\n}\n\nexport function SortableElement<T extends React.HTMLAttributes<HTMLElement>>(\n  Component: ReactFC<T>\n): ReactFC<T & ISortableElementProps> {\n  return ({ index = 0, lockAxis, ...props }) => {\n    const sortable = useSortable({\n      id: index + 1,\n    })\n    const { setNodeRef, transform, transition, isDragging } = sortable\n    if (transform) {\n      switch (lockAxis) {\n        case 'x':\n          transform.y = 0\n          break\n        case 'y':\n          transform.x = 0\n          break\n        default:\n          break\n      }\n    }\n\n    const style = useMemo(() => {\n      const itemStyle: React.CSSProperties = {\n        position: 'relative',\n        touchAction: 'none',\n        zIndex: 1,\n        transform: `translate3d(${transform?.x || 0}px, ${\n          transform?.y || 0\n        }px, 0)`,\n        transition: `${transform ? 'all 200ms ease' : ''}`,\n      }\n      const dragStyle: React.CSSProperties = {\n        transition,\n        opacity: '0.8',\n        transform: `translate3d(${transform?.x || 0}px, ${\n          transform?.y || 0\n        }px, 0)`,\n      }\n\n      const computedStyle = isDragging\n        ? {\n            ...itemStyle,\n            ...dragStyle,\n            ...props.style,\n          }\n        : {\n            ...itemStyle,\n            ...props.style,\n          }\n\n      return computedStyle\n    }, [isDragging, transform, transition, props.style])\n\n    return (\n      <SortableItemContext.Provider value={sortable}>\n        {Component({\n          ...props,\n          style,\n          ref: setNodeRef,\n        } as unknown as T)}\n      </SortableItemContext.Provider>\n    )\n  }\n}\n\nexport function SortableHandle<T extends React.HTMLAttributes<HTMLElement>>(\n  Component: ReactFC<T>\n): ReactFC<T> {\n  return (props: T) => {\n    const { attributes, listeners } = useSortableItem()\n    return <Component {...props} {...attributes} {...listeners} />\n  }\n}\n"]}